<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>禧月 · 产后护理预约系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- 引入 Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp, query, onSnapshot, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // --- 核心配置区 ---
        // 已为您填入真实的 Firebase 配置并清理了非法字符
        const firebaseConfig = {
            apiKey: "AIzaSyCv8KymzOvoTnPH6y-8vPIrzfmmvg_4KEo",
            authDomain: "postpartummassage-decc7.firebaseapp.com",
            projectId: "postpartummassage-decc7",
            storageBucket: "postpartummassage-decc7.firebasestorage.app",
            messagingSenderId: "217683596543",
            appId: "1:217683596543:web:79c23cae80498e5f37e8ca",
            measurementId: "G-9HD8LQLG9L"
        };

        // 初始化 Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        // 这里的 appId 是为了在 Firestore 路径中区分不同的应用实例
        const appId = "postpartummassage-decc7-web"; 

        // 导出到全局供应用逻辑使用
        window.fb = { db, collection, addDoc, serverTimestamp, auth, signInAnonymously, onAuthStateChanged, appId, query, onSnapshot, orderBy, limit };
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;700;900&display=swap');
        body { font-family: 'Noto Sans SC', sans-serif; }
        .bg-pattern {
            background-color: #fffafb;
            background-image: radial-gradient(#ffe4e6 0.5px, transparent 0.5px);
            background-size: 20px 20px;
        }
    </style>
</head>
<body class="bg-pattern text-slate-800">

    <!-- 顶部导航 -->
    <nav class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-rose-100">
        <div class="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-rose-500 rounded-lg flex items-center justify-center text-white">
                    <i data-lucide="heart" class="w-5 h-5 fill-current"></i>
                </div>
                <span class="text-xl font-bold text-slate-900">禧月 · 产后护理</span>
            </div>
            <div class="hidden md:flex gap-8 items-center text-sm font-medium">
                <a href="#services" class="hover:text-rose-500">服务项目</a>
                <a href="#booking" class="hover:text-rose-500">立即预约</a>
                <a href="#booking" class="bg-rose-500 text-white px-5 py-2 rounded-full hover:bg-rose-600 shadow-lg shadow-rose-200 transition-all">
                    免费咨询
                </a>
            </div>
        </div>
    </nav>

    <!-- Hero 视觉区 -->
    <section class="py-16 md:py-24 px-4">
        <div class="max-w-6xl mx-auto text-center space-y-8">
            <div class="inline-block px-4 py-1 bg-rose-50 text-rose-500 rounded-full text-xs font-bold tracking-widest uppercase">
                专业 · 科学 · 有温度
            </div>
            <h1 class="text-4xl md:text-6xl font-black text-slate-900 leading-tight">
                给新手妈妈<br><span class="text-rose-500">最温柔的康复关怀</span>
            </h1>
            <p class="text-slate-500 text-lg max-w-2xl mx-auto leading-relaxed">
                我们结合现代科学与传统护理经验，为您提供从月子照护到产后修复的全方位服务。
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center pt-4">
                <a href="#booking" class="px-8 py-4 bg-slate-900 text-white rounded-2xl font-bold text-lg hover:shadow-xl transition-all">
                    开始预约登记
                </a>
            </div>
        </div>
    </section>

    <!-- 预约系统 -->
    <section id="booking" class="py-20 px-4">
        <div class="max-w-4xl mx-auto bg-slate-900 rounded-[3rem] overflow-hidden shadow-2xl flex flex-col md:flex-row">
            <div class="md:w-1/2 p-10 md:p-14 text-white flex flex-col justify-between">
                <div>
                    <h2 class="text-3xl font-black mb-6">在线预约登记</h2>
                    <p class="text-slate-400 leading-relaxed mb-8">
                        提交您的联系方式和意向时间，我们将为您安排专业评估。
                    </p>
                </div>
                <div class="mt-12">
                    <p class="text-xs text-slate-500 uppercase tracking-widest font-bold mb-2">咨询热线</p>
                    <p class="text-2xl font-black text-rose-500">400-888-9999</p>
                </div>
            </div>
            
            <div class="md:w-1/2 bg-white p-10 md:p-14">
                <form id="bookingForm" class="space-y-5">
                    <div class="space-y-1">
                        <label class="text-xs font-bold text-slate-400 uppercase">您的姓名</label>
                        <input type="text" id="name" required placeholder="请填写姓名" class="w-full px-4 py-3 bg-slate-50 rounded-xl outline-none">
                    </div>
                    <div class="space-y-1">
                        <label class="text-xs font-bold text-slate-400 uppercase">联系电话</label>
                        <input type="tel" id="phone" required placeholder="请输入手机号" class="w-full px-4 py-3 bg-slate-50 rounded-xl outline-none">
                    </div>
                    <div class="space-y-1">
                        <label class="text-xs font-bold text-slate-400 uppercase">预约日期</label>
                        <input type="date" id="date" required class="w-full px-4 py-3 bg-slate-50 rounded-xl outline-none">
                    </div>
                    <div class="pt-4">
                        <button type="submit" id="submitBtn" class="w-full py-4 bg-rose-500 text-white rounded-xl font-bold text-lg hover:bg-rose-600 shadow-lg shadow-rose-100 transition-all">
                            确认预约
                        </button>
                    </div>
                </form>
                <div id="successMsg" class="hidden py-12 text-center">
                    <i data-lucide="check-circle" class="w-16 h-16 text-green-500 mx-auto mb-4"></i>
                    <h3 class="text-xl font-bold">已同步至云端!</h3>
                    <p class="text-slate-400 text-sm mt-2">感谢您的信赖</p>
                </div>
            </div>
        </div>
    </section>

    <!-- 底部预览区 -->
    <footer class="py-12 px-4 border-t border-slate-100 bg-slate-50">
        <div class="max-w-6xl mx-auto text-center space-y-4">
            <div class="flex justify-center gap-2">
                <div class="w-2 h-2 bg-green-500 rounded-full animate-ping"></div>
                <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">已链接 FIREBASE 实时数据库</span>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-inner max-w-md mx-auto">
                <p class="text-xs text-slate-400 mb-2 font-bold uppercase">最新云端预约</p>
                <div id="dataList" class="space-y-2 text-left">
                    <p class="text-xs text-slate-300 italic text-center">正在同步云端...</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        let isFirebaseReady = false;

        async function initApp() {
            if (window.lucide) window.lucide.createIcons();
            const checkFB = setInterval(() => {
                if (window.fb) {
                    clearInterval(checkFB);
                    setupFirebaseLogic();
                }
            }, 100);
        }

        async function setupFirebaseLogic() {
            const { db, collection, addDoc, serverTimestamp, auth, signInAnonymously, onAuthStateChanged, appId, query, onSnapshot, limit } = window.fb;

            // 1. 匿名登录
            try {
                await signInAnonymously(auth);
            } catch (e) {
                console.error("Firebase Auth 失败，请检查是否在控制台开启了匿名登录功能:", e);
            }

            onAuthStateChanged(auth, (user) => {
                if (user) {
                    isFirebaseReady = true;
                    startRealtimeListener();
                }
            });

            const form = document.getElementById('bookingForm');
            const successMsg = document.getElementById('successMsg');
            const dataList = document.getElementById('dataList');

            // 2. 提交数据
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!isFirebaseReady) {
                    alert("数据库尚未就绪，请稍等...");
                    return;
                }

                const submitBtn = document.getElementById('submitBtn');
                submitBtn.disabled = true;
                submitBtn.innerText = "提交中...";

                try {
                    const name = document.getElementById('name').value;
                    const phone = document.getElementById('phone').value;
                    const date = document.getElementById('date').value;

                    // 遵循特定路径规则
                    const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'bookings');
                    
                    await addDoc(colRef, {
                        name,
                        phone,
                        bookingDate: date,
                        createdAt: serverTimestamp()
                    });

                    form.classList.add('hidden');
                    successMsg.classList.remove('hidden');

                    setTimeout(() => {
                        form.reset();
                        form.classList.remove('hidden');
                        successMsg.classList.add('hidden');
                        submitBtn.disabled = false;
                        submitBtn.innerText = "确认预约";
                    }, 5000);

                } catch (err) {
                    console.error("提交失败:", err);
                    submitBtn.innerText = "提交失败，请重试";
                    submitBtn.disabled = false;
                }
            });

            // 3. 实时监听
            function startRealtimeListener() {
                const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'bookings');
                const q = query(colRef, limit(10));

                onSnapshot(q, (snapshot) => {
                    const items = [];
                    snapshot.forEach(doc => items.push(doc.data()));
                    
                    // 按创建时间倒序排
                    items.sort((a, b) => {
                        const timeA = a.createdAt?.seconds || 0;
                        const timeB = b.createdAt?.seconds || 0;
                        return timeB - timeA;
                    });

                    dataList.innerHTML = items.length ? items.slice(0, 3).map(item => `
                        <div class="flex justify-between items-center text-xs py-2 border-b border-slate-50 last:border-none">
                            <span class="font-bold text-slate-700">${item.name || '匿名用户'}</span>
                            <span class="text-slate-400 text-[10px]">${item.bookingDate || ''}</span>
                            <span class="px-2 py-0.5 bg-rose-50 text-rose-500 rounded font-bold">已同步</span>
                        </div>
                    `).join('') : '<p class="text-xs text-slate-300 text-center">暂无预约</p>';
                }, (error) => {
                    console.error("监听失败 (权限不足或集合未创建):", error);
                    dataList.innerHTML = '<p class="text-xs text-red-400 text-center">连接失败，请检查规则</p>';
                });
            }
        }

        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
